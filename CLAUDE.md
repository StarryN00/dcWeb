# CLAUDE.md

这个文件为 Claude Code (claude.ai/code) 在此代码库中工作时提供指导。

## 项目概述

这是一个**装修公司官网项目**,采用极简主义设计风格(Inter字体、stone色系),提供客户案例展示、潜客收集、项目管理等核心功能。

## 项目结构

```
dcWeb/
├── docs/               # 项目文档目录
│   ├── 产品需求.md     # 完整的产品功能需求文档
│   ├── 半包业主自购主材.md  # 半包装修材料采购流程文档
│   ├── 半包装修各阶段确认事项.md  # 半包装修各阶段事项清单
│   └── generated-page.html  # 生成的HTML页面示例
```

## 核心业务功能

### 1. 前端展示系统
- **首页**: Hero区域、服务介绍、精选案例展示、需求问答入口
- **案例展示系统**:
  - 案例列表页 (`/cases`): 支持按风格、面积、价格筛选
  - 案例详情页 (`/cases/:id`): 图片轮播、项目信息、业主感言
- **需求问答向导**: 6步交互式问答,自动潜客评分(50-100分)

### 2. 管理后台
- **案例管理** (`/admin/cases`): CRUD操作、上下架控制、推荐标记
- **潜客管理** (`/admin/leads`): 查看详情、更新状态、自动评分展示

### 3. 业务知识库
项目包含完整的半包装修业务流程文档:
- **装修阶段**: 前期准备 → 主体拆改 → 水电改造 → 泥瓦施工 → 木工施工 → 油漆施工 → 安装阶段 → 收尾阶段
- **业主采购材料清单**: 按时间阶段详细列出需自购的主材、设备及确认事项
- **关键节点**: 全屋定制(提前30-45天)、窗户大门(40天制作周期)、预埋类器具等

## 设计规范

### 视觉设计
- **字体**: Inter (Google Fonts)
- **配色**: Stone 色系 (stone-50, stone-100, stone-200, stone-500, stone-800, stone-900)
- **设计风格**: 极简主义、现代、北欧风
- **响应式**: 移动优先设计 (移动端1列、平板2列、桌面3列)

### UI组件特点
- 毛玻璃效果卡片 (`backdrop-blur`)
- 悬停效果: 图片放大、卡片阴影增强
- 渐变背景: `bg-gradient-to-t from-black/80`
- 固定顶部导航: `fixed w-full backdrop-blur-md`

## 数据模型

### 案例 (Cases)
```
- 标题、位置、风格(现代/北欧/工业/侘寂/轻奢/极简/中式/欧式)
- 面积(㎡)、工期(天)、价格(万元)
- 图片URL列表、项目描述、业主感言
- 施工队长(名称、电话)
- 装修阶段、推荐标记(featured)
- 状态(published/draft)
```

### 潜客 (Leads)
```
- 基本信息: 姓名、电话、物业类型
- 需求信息: 面积、预算、风格偏好(多选)
- 装修阶段、时间规划
- 自动评分(50-100分): 基础分50 + 预算评分(最高30) + 面积评分(最高10) + 时间评分(最高10)
- 提交时间、跟进状态
```

## 开发注意事项

### 装修业务逻辑
1. **半包模式**: 公司负责辅料及基础施工,业主需自行采购核心主材
2. **时间规划**: 全屋定制、门窗等大件需提前30-45天下单
3. **阶段依赖**: 水电定位前需确定预埋件、泥瓦前需完成门窗安装
4. **关键材料**:
   - 预埋类: 壁挂马桶、墙埋花洒、新风管道固定件
   - 定制类: 全屋定制(衣柜、橱柜)、窗户、大门
   - 设备类: 中央空调、新风系统、地暖、净水设备

### 潜客评分算法
```
总分 = 基础分(50) + 预算评分 + 面积评分 + 时间评分
- 预算评分: 预算越高分数越高 (最高+30分)
- 面积评分: 面积越大分数越高 (最高+10分)
- 时间评分: 时间越紧急分数越高 (最高+10分)
  - 1个月内: +10分
  - 1-3个月: +7分
  - 3-6个月: +5分
  - 6个月以上: +3分
  - 暂无计划: +0分
```

### 案例筛选逻辑
- 支持多维度组合筛选(风格 + 面积范围 + 价格范围)
- 推荐案例优先展示在首页
- 未发布案例(draft)仅管理员可见

## 文档参考

- **产品需求**: 查看 `memory/design/product-requirements.md` 了解完整功能规格
- **装修流程**: 查看 `memory/design/renovation-materials-timeline.md` 了解8个装修阶段的详细流程
- **确认事项**: 查看 `memory/design/renovation-checklist.md` 了解各阶段业主需采购/确认的清单
- **页面示例**: 查看 `docs/generated-page.html` 了解实际页面结构和设计风格

---

## 记忆管理

当用户要求你处理记忆相关的事情时（例如"记住这个"、"保存计划"、"记录这个Bug"），你应该首先查看 CLAUDE.md 和 memory/README.md 来了解记忆的组织方式。

### 三层系统

**CLAUDE.md (Agent 核心记忆)**
- 稳定的基础知识，所有未来 agents 都需要
- 装修业务术语、设计规范、核心实现原则
- 必须保持简洁；很少更新
- 位置: `/CLAUDE.md`

**memory/ (Agent 工作记忆)**
- 详细的设计文档、实现计划和调试调查
- 在活跃开发期间频繁演进
- 可以详细和冗长
- 位置: `/memory/` (查看 memory/README.md 了解索引)

**模块 READMEs (模块特定文档)**
- 单个模块的架构和 API
- 使用示例和设置说明
- agents 和人类都会阅读
- 位置: 分散在各处 (例如 `src/[module]/README.md`, `[component]/README.md`)

### 放在哪里？

| 信息类型 | 位置 | 原因 |
|-----------------|----------|-----|
| 高层次：什么是这个项目？ | CLAUDE.md | 核心概念知识 |
| 详细的装修业务流程规范 | `memory/design/{topic}.md` | 跨模块系统规范 |
| 前端组件实现细节 | `src/{component}/README.md` | 模块特定架构 |
| 设计决策理由 | `memory/design/` | 跨模块设计决策 |
| 关键概念设计（如潜客评分系统） | `memory/design/{concept}.md` | 跨模块设计决策 |
| 如何运行工具/测试 | `{component}/README.md` | 模块特定用法 |
| 组件性能测试 | 测试目录 | 组件特定测试 |
| 集成/系统测试 | `test/` | 系统级测试 |
| 关键测试文档 | `memory/testing/` | 测试理由和 Bug 历史 |
| Bug 调查和根因分析 | `memory/debugging/` | 跨模块调试会话 |
| 重构计划 | `memory/plans/` | 活跃的跨模块工作 |
| 组件 API | `src/{component}/README.md` | 模块特定 API |

### 更新协议

**Agent 行为（详见 `memory/README.md`）：**
- 明确请求 → 直接执行
- 暗示文档化 → 展示计划和内容预览
- Agent 发现 → 展示计划和理由

**CLAUDE.md** - 最高内容标准：
- 仅用于所有未来 agents 必须知道的知识
- 稳定的约定和永久原则
- 必须简洁和基础

**memory/** - 工作知识：
- 跨模块的设计和理由
- 实现计划（在归档前提取设计决策）
- 调试调查和根因分析
- 详见 `memory/README.md` 的详细指南

**模块 READMEs** - 模块特定：
- 该模块的架构和 APIs
- 使用示例和设置说明
- 更新该模块时可以更自由地编辑

**归档协议：**
- 从计划中提取设计决策 → `memory/design/`
- 已完成的计划 → `memory/archive/completed/`
- 被替代的设计 → `memory/archive/deprecated/`

### Bug 记录最佳实践

当修复重要的 Bug 时,应该在 `memory/debugging/` 目录中创建详细的调试文档,包含以下内容:

**必需章节:**
1. **Bug 概述** - 日期、影响范围、严重程度、相关版本
2. **问题特征** - 用户报错信息、关键错误日志、典型触发场景
3. **根本原因** - 深入分析问题的根源(不只是表面现象)
4. **排查过程** - 定位问题的步骤和思路(帮助未来调试)
5. **修复方案** - 正确的代码模式、修复步骤、已修复文件清单
6. **验证方法** - 如何确认 Bug 已修复
7. **预防措施** - 代码审查清单、类型检查、测试建议
8. **经验教训** - 从这个 Bug 中学到的关键点
9. **快速参考** - 症状-原因-修复的速查表

**记录时机:**
- ✅ 影响多个模块或核心功能的 Bug
- ✅ 排查过程复杂、需要深入分析的问题
- ✅ 框架/依赖升级导致的破坏性变更
- ✅ 容易重复出现或难以定位的问题
- ❌ 简单的拼写错误或单行修复(不需要记录)

**文档命名:** 使用描述性的 kebab-case 命名
- 示例: `nextjs-15-params-promise-bug.md`
- 示例: `prisma-connection-pool-timeout.md`
- 示例: `react-hydration-mismatch.md`

**更新索引:** 创建调试文档后,必须更新 `memory/README.md` 的索引,添加文档描述
