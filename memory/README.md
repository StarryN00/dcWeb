# Agent 工作记忆

## 目的

这个目录包含详细的设计文档和实现计划，agents 在会话间作为工作记忆使用。

**对于稳定的核心知识**，查看 `/CLAUDE.md`。
**对于模块特定信息**，查看模块 READMEs（例如 `src/[module]/README.md`）。

## 目录结构

### memory/design/
影响多个模块的设计文档和架构决策。

- **product-requirements.md** - 装修公司官网完整产品需求文档（前端展示系统、管理后台、需求问答向导）
- **renovation-materials-timeline.md** - 半包装修8个阶段的材料采购时间线和详细流程
- **renovation-checklist.md** - 半包装修各阶段业主需自购材料及确认事项清单

### memory/testing/
关键测试和测试文档。

- **README.md** - 测试理念和关键测试概览

（当前为空 - 随着测试开发会添加测试文档）

### memory/debugging/
Bug 调查笔记、根因分析和调试工作流。

- **nextjs-15-params-promise-bug.md** - Next.js 15+ 动态路由 params 变成 Promise 导致 API 返回 `id: undefined` 错误的根因分析和修复方案
- **admin-leads-undefined-error.md** - 管理后台潜客列表 undefined 错误调试
- **tailwind-postcss-fix.md** - Tailwind CSS 和 PostCSS 配置问题修复
- **tailwind-version-fix-final.md** - Tailwind 版本兼容性最终修复方案

### memory/plans/
跨越多个模块的活跃实现计划。完成后归档。

- **半包装修指导工具产品规划.md** - [活跃]: 独立的装修指导工具产品规划

### memory/archive/
已完成的计划和被替代的设计。

- `memory/archive/completed/` - 已完成的实现计划
- `memory/archive/deprecated/` - 被替代的设计文档和实现笔记

## Agent 文档协议

### Agents 应该如何表现（适用于所有位置）

#### 情况 1: 用户给出明确指示
**示例：**
- "添加这个到 memory/design/"
- "在 CLAUDE.md 中记录这个"
- 从 memory/plans/ 中的现有计划工作

**Agent 行为：** 直接执行

#### 情况 2: 用户暗示文档化
**示例：**
- "记住[案例系统]使用[方法]"
- "记住[潜客评分算法]是..."
- "注意我们决定使用[选择]而不是[替代方案]"

**Agent 行为：** 展示计划和内容预览
```
"我将在 memory/design/[doc_name].md 中记录这个：
- 添加关于[主题]的章节
- 内容：[你将写的实际内容]
是否继续？"
```

#### 情况 3: Agent 发现值得记录的内容
**示例：**
- 编码时发现重要的设计模式
- 意识到一个约定被一致使用

**Agent 行为：** 展示计划和理由
```
"我发现[发现]。我可以用以下内容更新 memory/[location]/[doc].md：
- [内容项 1]
- [内容项 2]
- [内容项 3]
是否进行此更新？"
```

## 内容标准（放在哪里）

**注意：** 这些是内容标准，不是权限级别。上述行为协议适用于所有目标位置。

### CLAUDE.md（最高内容标准）

**仅在以下情况添加：**
- 所有未来 agents 必须知道的信息
- 约定或原则是稳定和永久的
- 内容简洁和基础
- 示例：装修业务术语、核心设计规范、数据模型结构

**不适用于：**
- 详细解释（使用 memory/）
- 模块特定信息（使用模块 READMEs）
- 临时决策或探索

### memory/（工作知识）

**在以下情况添加 memory/design/ 文档：**
- 完成影响多个模块的设计功能后
- 做出具有项目范围影响的架构决策后
- 为未来 agents 记录设计理由

**在以下情况添加 memory/debugging/ 文档：**
- 调查跨越多个模块的复杂 bugs
- 记录关键问题的根因分析
- 记录有效的调试工作流和技术
- 保存调试会话的见解以供未来参考

**在以下情况添加 memory/plans/ 文档：**
- 规划跨越多个模块的重构
- 设计需要多个步骤的复杂功能
- 头脑风暴设计决策
- 协调整个代码库的变更

### 模块 READMEs（模块特定）

**在以下情况使用模块 README（例如 `src/[module]/README.md`）：**
- 记录单个模块的架构
- 解释模块特定的 APIs
- 提供模块的使用示例
- 描述模块文件组织

**在以下情况可以更自由地编辑：**
- 对该模块进行代码更改
- 重构后更新 API 文档
- 为新功能添加使用示例

## 示例

| 信息 | 正确位置 | 原因 |
|-------------|------------------|--------|
| "高层次：什么是装修公司官网项目？" | CLAUDE.md | 核心概念知识 |
| "详细：装修业务流程规范" | memory/design/renovation-workflow.md | 跨模块系统规范 |
| "为什么我们选择这个潜客评分算法" | memory/design/ | 设计理由，可能演进 |
| "案例展示系统的组件 API 和逻辑" | src/cases/README.md | 模块特定架构 |
| "如何运行前端测试" | frontend/README.md | 模块特定用法 |
| "影响案例系统和潜客管理的 Bug 调查" | memory/debugging/ | 跨模块调试会话 |
| "重构装修指导工具的计划" | memory/plans/ | 活跃的跨模块工作 |

## 维护

### 归档协议

**当你完成一个计划时：**
- 识别值得保留的设计决策和理由
- 提出建议：
  1. 将设计决策提取到相关的 `memory/design/` 文档
  2. 将计划本身归档到 `memory/archive/completed/`
- 注意：计划通常包含超出实现步骤的宝贵见解

**当你注意到不活跃/废弃的计划时：**
- 评估计划是否包含有用的设计决策或经验
- 提出在归档前提取有价值内容的建议
- 归档到 `memory/archive/abandoned/` 并注明为何中止

**当设计变得过时时：**
- 识别什么替代了它并记录演变
- 提出归档建议并添加弃用说明
- 检查 CLAUDE.md 是否需要更新以反映新方法

**当 Bug 被解决时：**
- 考虑调试见解是否对未来有价值
- 提出在 memory/debugging/ 中记录根因分析的建议
- 链接相关修复和从调试中产生的设计决策

### README 维护

**在任何记忆更新后：**
- 检查 `memory/README.md` 目录索引是否需要更新
- 添加/移动/归档文档时更新文件列表
- 保持索引与实际目录结构同步
