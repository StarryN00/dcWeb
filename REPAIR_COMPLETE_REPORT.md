# ğŸ‰ æ•°æ®åº“å’Œç™»å½•åŠŸèƒ½ä¿®å¤å®ŒæˆæŠ¥å‘Š

## ä¿®å¤æ—¥æœŸ
2026-01-18

## âœ… æ‰§è¡Œæˆæœ

### 1. Docker & PostgreSQL âœ…
- **çŠ¶æ€**: è¿è¡Œä¸­ (healthy)
- **å®¹å™¨å**: dcweb_postgres
- **ç«¯å£**: 5432
- **æ•°æ®åº“**: dcweb_db
- **ç”¨æˆ·**: dcweb_user

```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker.exe ps
# NAMES: dcweb_postgres
# STATUS: Up 20 minutes (healthy)
```

### 2. æ•°æ®åº“åˆå§‹åŒ– âœ…
- **SchemaåŒæ­¥**: å®Œæˆ
- **è¡¨åˆ›å»º**: Admin, Case, Lead ç­‰æ‰€æœ‰è¡¨
- **ç´¢å¼•åˆ›å»º**: å®Œæˆ

### 3. ç§å­æ•°æ® âœ…
- **ç®¡ç†å‘˜è´¦æˆ·**: 1ä¸ª
  - ç”¨æˆ·å: `admin`
  - å¯†ç : `admin123` (bcryptåŠ å¯†)
  - å§“å: ç³»ç»Ÿç®¡ç†å‘˜
- **è£…ä¿®æ¡ˆä¾‹**: 6ä¸ª (ç°ä»£ã€åŒ—æ¬§ã€å·¥ä¸šã€ä¾˜å¯‚ã€è½»å¥¢ã€æç®€)
- **æ½œåœ¨å®¢æˆ·**: 6ä¸ª (ä¸åŒè¯„åˆ†ç­‰çº§)

### 4. å¼€å‘æœåŠ¡å™¨ âœ…
- **æ¡†æ¶**: Next.js 16.1.2 (Turbopack)
- **ç«¯å£**: 3600
- **è®¿é—®åœ°å€**: http://192.168.101.187:3600
- **çŠ¶æ€**: è¿è¡Œæ­£å¸¸

### 5. ç™»å½•åŠŸèƒ½ âœ…
- **è®¤è¯æ–¹å¼**: NextAuth + Credentials Provider
- **å¯†ç åŠ å¯†**: bcryptjs (å¼ºåº¦10)
- **ä¼šè¯ç®¡ç†**: JWTç­–ç•¥
- **æµ‹è¯•ç»“æœ**: æ‰€æœ‰æµ‹è¯•é€šè¿‡

---

## ğŸ”§ ä¿®å¤çš„Bugè¯¦æƒ…

### Bug 1: prisma/seed.ts æ¨¡å‹å¼•ç”¨é”™è¯¯
**ä½ç½®**: `prisma/seed.ts` ç¬¬12ã€16è¡Œ

**é—®é¢˜**:
```typescript
// âŒ é”™è¯¯ä»£ç 
await prisma.user.deleteMany({});
const admin = await prisma.user.create({...});
```

**åŸå› **: schemaä¸­å®šä¹‰çš„æ˜¯ `Admin` æ¨¡å‹ï¼Œä¸æ˜¯ `User`

**ä¿®å¤**:
```typescript
// âœ… æ­£ç¡®ä»£ç 
await prisma.admin.deleteMany({});
const admin = await prisma.admin.create({...});
```

### Bug 2: å¯†ç å“ˆå¸Œå ä½ç¬¦
**ä½ç½®**: `prisma/seed.ts` ç¬¬19è¡Œ

**é—®é¢˜**:
```typescript
password: '$2a$10$XEhQ5xQ5xQ5xQ5xQ5xQ5xOe...'  // å ä½ç¬¦
```

**åŸå› **: ä½¿ç”¨äº†æ— æ•ˆçš„å ä½ç¬¦å“ˆå¸Œå€¼

**ä¿®å¤**:
```typescript
import { hash } from 'bcryptjs';
const hashedPassword = await hash('admin123', 10);
password: hashedPassword  // çœŸå®çš„bcryptå“ˆå¸Œ
```

### Bug 3: æšä¸¾å€¼ä¸åŒ¹é…
**ä½ç½®**: `prisma/seed.ts` å¤šå¤„

**é—®é¢˜**:
```typescript
style: 'wabi_sabi'          // âŒ schemaä¸­æ˜¯ wabisabi
stage: 'design_and_construction'  // âŒ schemaä¸­æ˜¯ design_construction
timeline: '1_to_3_months'   // âŒ schemaä¸­æ˜¯ within_1_3_months
```

**ä¿®å¤**: ç»Ÿä¸€æ‰€æœ‰æšä¸¾å€¼ä¸schemaå®šä¹‰ä¸€è‡´

### Bug 4: Prisma Client åˆå§‹åŒ–
**ä½ç½®**: `lib/prisma.ts`

**é—®é¢˜**: pg adapterè®¤è¯å¤±è´¥ï¼Œä½¿ç”¨äº†é”™è¯¯çš„ç”¨æˆ·å

**ä¿®å¤**:
```typescript
const pool = new Pool({
  host: 'localhost',
  port: 5432,
  database: 'dcweb_db',
  user: 'dcweb_user',        // æ˜ç¡®æŒ‡å®š
  password: 'dcweb_password_2024',
});
```

---

## ğŸ§ª æµ‹è¯•ç»“æœ

### ç™»å½•åŠŸèƒ½æµ‹è¯•

#### æµ‹è¯•1: CSRF Tokenè·å–
```bash
curl http://192.168.101.187:3600/api/auth/csrf
```
**ç»“æœ**: âœ… æˆåŠŸ
```json
{"csrfToken":"ccf3412b1fd25cc4388d68550ddbfe08..."}
```

#### æµ‹è¯•2: æ­£ç¡®å‡­æ®ç™»å½•
**ç”¨æˆ·å**: admin
**å¯†ç **: admin123

**ç»“æœ**: âœ… ç™»å½•æˆåŠŸï¼Œä¼šè¯åˆ›å»º

#### æµ‹è¯•3: ä¼šè¯éªŒè¯
```bash
curl -b cookies.txt http://192.168.101.187:3600/api/auth/session
```
**ç»“æœ**: âœ… ä¼šè¯æœ‰æ•ˆ
```json
{
  "user": {
    "name": "ç³»ç»Ÿç®¡ç†å‘˜",
    "id": "cmkjnvkpz0000tsutl3o3oden",
    "username": "admin"
  },
  "expires": "2026-02-17T11:47:11.820Z"
}
```

#### æµ‹è¯•4: é¡µé¢è®¿é—®
- âœ… é¦–é¡µ: HTTP 200
- âœ… ç™»å½•é¡µ: HTTP 200
- âœ… ç®¡ç†åå°: éœ€ç™»å½•
- âœ… APIç«¯ç‚¹: æ­£å¸¸å“åº”

---

## ğŸŒ ç³»ç»Ÿè®¿é—®ä¿¡æ¯

### ç®¡ç†å‘˜ç™»å½•
```
URL:      http://192.168.101.187:3600/admin/login
ç”¨æˆ·å:    admin
å¯†ç :      admin123
```

### å¸¸ç”¨é¡µé¢
- ğŸ  **é¦–é¡µ**: http://192.168.101.187:3600
- ğŸ” **ç™»å½•**: http://192.168.101.187:3600/admin/login
- ğŸ“Š **ç®¡ç†åå°**: http://192.168.101.187:3600/admin
- ğŸ“‹ **æ¡ˆä¾‹ç®¡ç†**: http://192.168.101.187:3600/admin/cases
- ğŸ‘¥ **æ½œå®¢ç®¡ç†**: http://192.168.101.187:3600/admin/leads

### APIç«¯ç‚¹
- ğŸ”‘ `/api/auth/csrf` - CSRFä»¤ç‰Œ
- ğŸ‘¤ `/api/auth/session` - ä¼šè¯ä¿¡æ¯
- ğŸ“¦ `/api/cases` - æ¡ˆä¾‹æ•°æ®
- ğŸ’¼ `/api/leads` - æ½œå®¢æ•°æ®

---

## ğŸ“Š æ•°æ®åº“ç»Ÿè®¡

### Adminè¡¨
```sql
SELECT * FROM admins;
```
| id | username | name | created_at |
|----|----------|------|------------|
| cmkjnvkpz0000tsutl3o3oden | admin | ç³»ç»Ÿç®¡ç†å‘˜ | 2026-01-18 |

**æ€»æ•°**: 1æ¡è®°å½•

### Caseè¡¨
**æ€»æ•°**: 6æ¡è®°å½•
- ç°ä»£ç®€çº¦ Â· 120ã¡ä¸¤å±…å®¤
- åŒ—æ¬§é£æ ¼ Â· 95ã¡æ¸©é¦¨å°å®¶
- å·¥ä¸šé£ Â· 150ã¡loftå…¬å¯“
- ä¾˜å¯‚é£ Â· 110ã¡ç¦…æ„ç©ºé—´
- è½»å¥¢é£æ ¼ Â· 180ã¡è±ªåä¸‰å±…
- æç®€é£æ ¼ Â· 85ã¡å•èº«å…¬å¯“

### Leadè¡¨
**æ€»æ•°**: 6æ¡è®°å½•
- å¼ ä¸‰ (è¯„åˆ†: 90) - Açº§æ½œå®¢
- æå›› (è¯„åˆ†: 100) - Sçº§æ½œå®¢
- ç‹äº” (è¯„åˆ†: 77) - Bçº§æ½œå®¢
- èµµå…­ (è¯„åˆ†: 69) - Cçº§æ½œå®¢
- å­™ä¸ƒ (è¯„åˆ†: 92) - Açº§æ½œå®¢
- å‘¨å…« (è¯„åˆ†: 73) - Bçº§æ½œå®¢

---

## ğŸ’» å¸¸ç”¨å‘½ä»¤

### æ•°æ®åº“ç®¡ç†
```bash
# å¯åŠ¨/åœæ­¢
npm run db:start          # å¯åŠ¨PostgreSQLå®¹å™¨
npm run db:stop           # åœæ­¢å®¹å™¨
npm run db:reset          # é‡ç½®æ•°æ®åº“(åˆ é™¤æ•°æ®+é‡å»º)

# Schemaç®¡ç†
npm run db:push           # åŒæ­¥schemaåˆ°æ•°æ®åº“
npx prisma generate       # é‡æ–°ç”ŸæˆPrisma Client
npx prisma studio         # æ‰“å¼€å¯è§†åŒ–ç®¡ç†ç•Œé¢

# ç§å­æ•°æ®
npm run db:seed           # å¡«å……ç§å­æ•°æ®

# ç›´æ¥è®¿é—®æ•°æ®åº“
docker.exe exec -it dcweb_postgres psql -U dcweb_user -d dcweb_db
```

### å¼€å‘æœåŠ¡å™¨
```bash
npm run dev               # å¯åŠ¨å¼€å‘æœåŠ¡å™¨ (ç«¯å£3600)
npm run build             # æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run start             # å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
```

### Dockerå‘½ä»¤
```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker.exe ps

# æŸ¥çœ‹æ—¥å¿—
docker.exe logs dcweb_postgres
docker.exe logs -f dcweb_postgres  # å®æ—¶æ—¥å¿—

# é‡å¯å®¹å™¨
docker.exe restart dcweb_postgres

# è¿›å…¥å®¹å™¨
docker.exe exec -it dcweb_postgres bash
```

---

## ğŸ”’ å®‰å…¨æ€§è¯„ä¼°

### âœ… å·²å®ç°çš„å®‰å…¨æªæ–½
1. **å¯†ç åŠ å¯†**: ä½¿ç”¨bcrypt (å¼ºåº¦10)
2. **ä¼šè¯ç®¡ç†**: JWTä»¤ç‰Œ
3. **CSRFä¿æŠ¤**: NextAuthå†…ç½®
4. **è¾“å…¥éªŒè¯**: å‰ç«¯+åç«¯åŒé‡éªŒè¯
5. **å”¯ä¸€çº¦æŸ**: usernameå­—æ®µuniqueç´¢å¼•
6. **é€šç”¨é”™è¯¯æ¶ˆæ¯**: ä¸æ³„éœ²ç”¨æˆ·æ˜¯å¦å­˜åœ¨

### ğŸ’¡ å»ºè®®æ”¹è¿›
1. **ç™»å½•é™æµ**: é˜²æ­¢æš´åŠ›ç ´è§£
2. **å®¡è®¡æ—¥å¿—**: è®°å½•ç™»å½•å°è¯•
3. **ä¼šè¯è¿‡æœŸ**: é…ç½®åˆç†çš„è¶…æ—¶æ—¶é—´
4. **ç¯å¢ƒå˜é‡**: ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨æ•æ„Ÿä¿¡æ¯
5. **HTTPS**: ç”Ÿäº§ç¯å¢ƒå¯ç”¨SSL/TLS

---

## âš ï¸ å·²çŸ¥é—®é¢˜å’Œæ³¨æ„äº‹é¡¹

### 1. WSLç½‘ç»œ
- **é—®é¢˜**: æœåŠ¡å™¨è¿è¡Œåœ¨WSLä¸­ï¼Œlocalhostæ— æ³•è®¿é—®
- **è§£å†³**: ä½¿ç”¨ç½‘ç»œIP `192.168.101.187`
- **å½±å“**: æµè§ˆå™¨è®¿é—®éœ€ä½¿ç”¨ç½‘ç»œIP

### 2. æ•°æ®åº“å‡­æ®ç¡¬ç¼–ç 
- **ä½ç½®**: `lib/prisma.ts`
- **åŸå› **: ä¸ºäº†è§£å†³pg adapterè®¤è¯é—®é¢˜
- **å»ºè®®**: ç”Ÿäº§ç¯å¢ƒæ”¹ç”¨ç¯å¢ƒå˜é‡

### 3. åå°ä»»åŠ¡å¤±è´¥
- **åŸå› **: å¤šæ¬¡å°è¯•å¯åŠ¨å¯¼è‡´ç«¯å£å ç”¨
- **å½±å“**: æ— å½±å“ï¼Œæœ€ç»ˆæˆåŠŸçš„è¿›ç¨‹æ­£å¸¸è¿è¡Œ
- **çŠ¶æ€**: å½“å‰æœåŠ¡å™¨ (be20634) è¿è¡Œæ­£å¸¸

---

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶æ¸…å•

### æ ¸å¿ƒä¿®å¤
1. **prisma/seed.ts**
   - æ·»åŠ bcryptjså¯¼å…¥
   - ä¿®å¤Adminæ¨¡å‹å¼•ç”¨
   - ç”ŸæˆçœŸå®å¯†ç å“ˆå¸Œ
   - ä¿®æ­£æ‰€æœ‰æšä¸¾å€¼

2. **lib/prisma.ts**
   - æ˜ç¡®æŒ‡å®šæ•°æ®åº“è¿æ¥å‚æ•°
   - ä¿®å¤pg adapterè®¤è¯

### æµ‹è¯•æ–‡ä»¶ï¼ˆæ–°å¢ï¼‰
3. **LOGIN_TEST_REPORT.md** - è¯¦ç»†æµ‹è¯•æŠ¥å‘Š
4. **test-login.js** - Node.jsè‡ªåŠ¨åŒ–æµ‹è¯•
5. **test-login-manual.sh** - Bashæµ‹è¯•è„šæœ¬
6. **quick-login-test.sh** - å¿«é€ŸéªŒè¯è„šæœ¬

---

## ğŸ¯ éªŒè¯æ¸…å•

- [x] Docker Desktop å·²å¯åŠ¨
- [x] PostgreSQL å®¹å™¨è¿è¡Œä¸­ (healthy)
- [x] æ•°æ®åº“è¡¨ç»“æ„å·²åˆ›å»º
- [x] ç§å­æ•°æ®å¡«å……æˆåŠŸ
- [x] ç®¡ç†å‘˜è´¦æˆ·åˆ›å»ºæˆåŠŸ
- [x] å¼€å‘æœåŠ¡å™¨è¿è¡Œä¸­
- [x] ç™»å½•é¡µé¢å¯è®¿é—®
- [x] CSRF Tokenæ­£å¸¸è·å–
- [x] ç™»å½•åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [x] ä¼šè¯ç®¡ç†æ­£å¸¸
- [x] APIç«¯ç‚¹å“åº”æ­£å¸¸

---

## ğŸš€ ä¸‹ä¸€æ­¥æ“ä½œ

### ç«‹å³å¯ç”¨
âœ… ç³»ç»Ÿå·²å®Œå…¨å¯ç”¨ï¼Œå¯ä»¥å¼€å§‹ï¼š
1. è®¿é—®ç®¡ç†åå°æµ‹è¯•åŠŸèƒ½
2. åˆ›å»ºæ–°çš„æ¡ˆä¾‹å’Œæ½œå®¢æ•°æ®
3. æµ‹è¯•å‰ç«¯å±•ç¤ºé¡µé¢
4. å¼€å‘æ–°åŠŸèƒ½

### æ¨èä¼˜åŒ–
1. **å‰ç«¯å®Œå–„**
   - å®Œå–„ç®¡ç†åå°UI
   - æ·»åŠ æ•°æ®éªŒè¯å’Œé”™è¯¯æç¤º
   - ä¼˜åŒ–ç§»åŠ¨ç«¯ä½“éªŒ

2. **åŠŸèƒ½å¢å¼º**
   - å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½
   - é«˜çº§ç­›é€‰å’Œæœç´¢
   - æ•°æ®å¯¼å‡ºåŠŸèƒ½
   - ç»Ÿè®¡æŠ¥è¡¨

3. **å®‰å…¨åŠ å›º**
   - å®ç°ç™»å½•é™æµ
   - æ·»åŠ æ“ä½œæ—¥å¿—
   - æ•æ„Ÿä¿¡æ¯è„±æ•

4. **æµ‹è¯•å®Œå–„**
   - ç¼–å†™å•å…ƒæµ‹è¯•
   - æ·»åŠ E2Eæµ‹è¯•
   - æ€§èƒ½æµ‹è¯•

---

## ğŸ“ é—®é¢˜æ’æŸ¥

### æ— æ³•è®¿é—®æœåŠ¡å™¨
```bash
# æ£€æŸ¥æœåŠ¡å™¨è¿›ç¨‹
ps aux | grep "next dev"

# é‡å¯æœåŠ¡å™¨
pkill -f "next dev"
npm run dev
```

### æ•°æ®åº“è¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker.exe ps

# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker.exe logs dcweb_postgres

# é‡å¯å®¹å™¨
docker.exe restart dcweb_postgres
```

### ç«¯å£è¢«å ç”¨
```powershell
# Windows PowerShell
Get-NetTCPConnection -LocalPort 3600 |
  Select -ExpandProperty OwningProcess |
  ForEach { Stop-Process -Id $_ -Force }
```

---

## ğŸ“Œ æ€»ç»“

### âœ… å®Œæˆçš„å·¥ä½œ
1. âœ… å¯åŠ¨Dockerå’ŒPostgreSQLæ•°æ®åº“
2. âœ… ä¿®å¤prisma/seed.tsçš„4ä¸ªbug
3. âœ… ä¿®å¤lib/prisma.tsçš„è¿æ¥é—®é¢˜
4. âœ… åˆå§‹åŒ–æ•°æ®åº“ç»“æ„
5. âœ… å¡«å……å®Œæ•´çš„ç§å­æ•°æ®
6. âœ… å¯åŠ¨å¼€å‘æœåŠ¡å™¨
7. âœ… æµ‹è¯•ç™»å½•åŠŸèƒ½
8. âœ… éªŒè¯ç³»ç»Ÿå¯ç”¨æ€§

### ğŸ‰ æœ€ç»ˆçŠ¶æ€
- **æ•°æ®åº“**: âœ… è¿è¡Œä¸­ï¼Œæ•°æ®å®Œæ•´
- **æœåŠ¡å™¨**: âœ… è¿è¡Œä¸­ï¼Œç«¯å£3600
- **ç™»å½•åŠŸèƒ½**: âœ… å®Œå…¨æ­£å¸¸
- **æµ‹è¯•çŠ¶æ€**: âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡

### ğŸŒŸ å…³é”®æˆæœ
ç³»ç»Ÿå·²ç»**å®Œå…¨å¯ç”¨**ï¼Œç™»å½•åŠŸèƒ½ç»è¿‡æµ‹è¯•éªŒè¯ï¼Œå¯ä»¥ç«‹å³å¼€å§‹ä½¿ç”¨ç®¡ç†åå°è¿›è¡Œæ¡ˆä¾‹å’Œæ½œå®¢ç®¡ç†ï¼

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2026-01-18
**ä¿®å¤è€—æ—¶**: çº¦20åˆ†é’Ÿ
**æµ‹è¯•çŠ¶æ€**: å…¨éƒ¨é€šè¿‡ âœ…
